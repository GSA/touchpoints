<div id="display-logo-div">
  <% form = @form %>
  <% if form.errors.any? %>
    <div id="error_explanation">
        <div class="usa-alert usa-alert--error" >
          <div class="usa-alert__body">
            <h3 class="usa-alert__heading">Error</h3>
            <p class="usa-alert__text">
              Logo upload failed, please try again with a valid image file
            </p>
          </div>
        </div>
    </div>
  <% end %>
  <%= form_with(model: form, url: (form.persisted? ? admin_form_path(form) : admin_forms_path), local: true) do |f| %>
    <% if form.persisted? %>
    <br>
    <div class="grid-row grid-gap-md">
      <div class="grid-col-12">
        <%= f.label :logo_display, "Display a Logo?", class: "usa-label text-uppercase font-body-3xs" %>
        <p>
          <%= f.file_field :logo, class: "usa-button display-logo", data_url:  admin_form_path(form) %>
          <span hidden="true" class="uploading-msg usa-hint save-notice">Uploading file, please wait...</span>
        </p>
        <% if form.logo.present? %>
          <fieldset class="usa-fieldset">
            <legend class="usa-sr-only">Display Organization Tag Logo</legend>
            <div class="usa-checkbox">
              <%= f.check_box :display_header_logo, class: "usa-checkbox__input", data_url:  admin_form_path(form) %>
              <%= f.label :display_header_logo, "Display (320px wide by 80px tall) Organization logo before the title in the Form header?", class: "usa-checkbox__label" %>
            </div>
          </fieldset>
          <fieldset class="usa-fieldset">
            <legend class="usa-sr-only">Display Organization Tag Logo</legend>
            <div class="usa-checkbox">
              <%= f.check_box :display_header_square_logo, class: "usa-checkbox__input",  data_url:  admin_form_path(form) %>
              <%= f.label :display_header_square_logo, "Display Square (80px wide by 80px tall) Organization logo before the title in the Form header?", class: "usa-checkbox__label" %>
            </div>
          </fieldset>
        <% end %>
      </div>
    </div>
    <br>
    <% end %>
  <% end %>
  <% if form.display_header_logo && form.logo.present? %>
    <%= image_tag(form.logo.tag.url, alt: "Organization logo", class: "form-header-logo") %>
  <% end %>
  <% if form.display_header_square_logo && form.logo.present? %>
    <%= image_tag(form.logo.logo_square.url, alt: "Organization logo", class: "form-header-logo-square") %>
  <% end %>
</div>
<br/>
<script>
  $(".display-logo").change(function(event) {
    event.preventDefault();
    $('.uploading-msg').show();
    display_logo_options_changed(this);
  });
  $("#form_display_header_logo").change(function(event) {
    event.preventDefault();
    display_logo_options_changed(this);
  });
  $("#form_display_header_square_logo").change(function(event) {
    event.preventDefault();
    display_logo_options_changed(this);
  });
  function display_logo_options_changed(elem) {

    var thisForm = $(elem).closest("form");
    var formData = new FormData($(thisForm)[0]);
    var fileData = $('.display-logo').prop('files')[0];
    // TODO: show uploading msg
    formData.append('logo',fileData);
    $.ajax({
      type: "PATCH",
      url: $(elem).attr("data_url") + "/update_display_logo",
      data: formData,
      async: true,
      cache: false,
      contentType: false,
      enctype: 'multipart/form-data',
      processData: false,
    }).done(function(data) {
      // show success or failure
      console.log('data updated..');
      $("#display-logo-div").html(data);
    });
  }
</script>