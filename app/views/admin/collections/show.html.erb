<% content_for :navigation_title do %>
  Data Collection
  <%= link_to edit_admin_collection_path(@collection), class: "usa-button usa-button-inverted float-right" do %>
    <i class="fa fa-pencil-alt"></i>
    Edit
  <% end %>
<% end %>

<p>
  <%= link_to admin_collections_path do %>
    <i class="fa fa-arrow-circle-left"></i>
    Back to Data Collections
  <% end %>
</p>

<h2>
  <%= @collection.name %>
</h2>

<% if !@collection.submitted? && !@collection.published? %>
<% elsif !@collection.published? %>
<% else %>
  <div class="usa-alert usa-alert--warning" >
    <div class="usa-alert__body">
      <p class="usa-alert__text">
        This data collection has been published.
      </p>
    </div>
  </div>
  <br>
<% end %>

<div class="text-uppercase font-body-3xs">
  About this data collection
</div>
<p>
  CX Customer Experience reporting is rooted in
  <a href="https://www.performance.gov/cx/assets/files/a11-280.pdf" target="_blank" rel="noopener">A-11 Section 280</a>
  guidance.
</p>
<p>
  Each quarter, OMB coordinates this data collection from all HISPs.
  This data will be summarized and reported on
  <a href="https://performance.gov/cx/" target="_blank" rel="noopener">performance.gov/cx</a>.
</p>

<div class="well">
  <div class="text-uppercase font-body-3xs">
    General information
  </div>
  <div class="grid-row">
    <div class="grid-col-4">
      <p>
        <strong>Organization</strong>
        <br>
        <%= @collection.organization.name %>
      </p>
      <p>
        <strong>User</strong>
        <br>
        <%= @collection.user.email if @collection.user %>
      </p>

    </div>
    <div class="grid-col-4">
      <p>
        <strong>Quarter and Fiscal year</strong>
        <br>
        Q<%= @collection.quarter %>
        FY<%= @collection.year %>
      </p>

      <p>
        <strong>Date range</strong>
        <br>
        <span><%= @collection.start_date %></span>
        to
        <br>
        <span><%= @collection.end_date %></span>
      </p>
    </div>
    <div class="grid-col-4">
      <p>
        <strong>Collection status</strong>
        <br>
        <%= @collection.aasm_state %>
      </p>
    </div>
  </div>
  <%= render 'components/step_indicator', collection: @collection %>
</div>

<div class="well">
  <h2>
    Services to report on
  </h2>
  <div class="usa-prose">
    Add a Service reporting page for each touchpoint within a HISP service.
    Each of these services correspond to the individual sheets within
    the previous version of the
    <a href="https://www.performance.gov/cx/assets/files/CX-Feedback-Data-Submission.xlsx" target="_blank">OMB Reporting spreadsheet template</a>.
    Some agencies may choose to use the spreadsheet to gather data
    and share it around internally for review and approval.
    If so, enter the spreadsheet data here, when complete.
  </div>
  <ul class="usa-list">
  <% OmbCxReportingCollection.where(collection_id: @collection.id).each do |collection| %>
    <li>
      <%= link_to (collection.service_provided || "this"), admin_omb_cx_reporting_collection_path(collection) %>
    </li>
  <% end %>
  </ul>
  <p>
    <%= link_to new_admin_omb_cx_reporting_collection_path, class: "usa-button usa-button--outline" do %>
      <i class="fa fa-plus"></i>
      Add a Service to report on
    <% end %>
  </p>
</div>

<% if admin_permissions? %>
<div class="well">
  <h4>
    CSV data for performance.gov/cx charts
  </h4>
  <p>
    hisp_service_id,year,quarter,touchpoint,surveys_offered_count,response_count,satisfied,trust,effective,easy,efficient,transparent,employee
    <br>
    <% @collection.omb_cx_reporting_collections.each do |omb_cx_reporting_collection| %>
    <%= omb_cx_reporting_collection.collection.organization.name %>,<%= omb_cx_reporting_collection.collection.year %>,<%= omb_cx_reporting_collection.collection.quarter %>,<%= omb_cx_reporting_collection.channel %>,
    <%= omb_cx_reporting_collection.volume_of_customers %>,
    <%= omb_cx_reporting_collection.volume_of_respondents %>,
    <%= omb_cx_reporting_collection.q1_point_scale %>,
    <%= omb_cx_reporting_collection.q2_point_scale %>,
    <%= omb_cx_reporting_collection.q3_point_scale %>,
    <%= omb_cx_reporting_collection.q4_point_scale %>,
    <%= omb_cx_reporting_collection.q5_point_scale %>,
    <%= omb_cx_reporting_collection.q6_point_scale %>,
    <%= omb_cx_reporting_collection.q7_point_scale %>
    <br>
    <% end %>
  </p>
</div>
<% end %>

<p>
  <strong>Reflection text</strong>
  <br>
  <%= @collection.reflection? ? simple_format(@collection.reflection) : "---" %>
</p>
<p hidden>
  <strong>Integrity hash</strong>
  <br>
  <%= @collection.integrity_hash || "not yet published" %>
</p>

<p>
  <% if !@collection.submitted? && !@collection.published? %>
    <%= link_to submit_admin_collection_path(@collection), class: "usa-button", method: "post" do %>
      Submit this Data Collection
    <% end %>
  <% elsif !@collection.published? && admin_permissions? %>
    <%= link_to publish_admin_collection_path(@collection), class: "usa-button", method: "post" do %>
      Publish this Data Collection
    <% end %>
  <% end %>
</p>
