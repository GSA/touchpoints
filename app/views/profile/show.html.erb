<% content_for :navigation_title do %>
  User Profile
<% end %>
<p>
  <%= link_to admin_forms_path do %>
    <i class="fa fa-arrow-circle-left"></i>
    Back to My Surveys
  <% end %>
</p>
<%= form_with(model: current_user, url: "profile", local: true) do |f| %>
  <div class="grid-row grid-gap-md">
    <div class="tablet:grid-col-6">
      <div class="field">
        <%= f.label :email, class: "usa-label" %>
        <span class="usa-hint"><%= current_user.email %></span>
      </div>
      <div class="field">
        <%= f.label :time_zone, class: "usa-label" %>
        <%= f.select :time_zone, options_for_select(ActiveSupport::TimeZone::MAPPING.keys.sort, selected: current_user.time_zone), { prompt: "Select a time zone" }, { class: "usa-select" } %>
      </div>
      <div class="field">
        <%= label_tag :api_key, "API Key", class: "usa-label" %>
        <% if current_user.api_key.present? %>
          <% if  @api_key_warning %>
            <div class="usa-alert usa-alert--warning" >
              <div class="usa-alert__body">
                <p class="usa-alert__text">
                  Your API Key was last updated more than six months ago!  Please remove then re-generate your API Key.
                </p>
              </div>
            </div>
          <% end %>
          <pre><%= current_user.api_key %></pre>
          <span class="usa-hint">last updated at <%= format_time(current_user.api_key_updated_at, current_user.time_zone) %></span>
          <div class="usa-alert usa-alert--info" >
            <div class="usa-alert__body">
              <h3 class="usa-alert__heading">API Documentation</h3>
              <p class="usa-alert__text">
                See the Touchpoints wiki for
                <a href="https://github.com/GSA/touchpoints/wiki/API" target="_blank" rel="noopener">API documentation</a>.
              </p>
            </div>
          </div>
        <% end %>
        <br>
      </div>
      <div class="field">
        <% if current_user.api_key.blank? %>
          <%= link_to "/profile/api_key", class: "usa-button usa-button--outline profile-add-api-key" do %>
            <i class="fa fa-plus"></i>
            Generate API Key
          <% end %>
        <% else %>
          <%= link_to "/profile/delete_api_key", class: "usa-button usa-button--secondary profile-delete-api-key" do %>
            <i class="fa fa-times"></i>&nbsp;
            Remove API Key
          <% end %>
        <% end %>
      </div>
      <div class="field">
        <br/>
        <%= f.submit class: "usa-button" %>
        <br/><br/>
      </div>
    </div>
  </div>
<% end %>
