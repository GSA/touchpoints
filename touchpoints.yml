applications:
- name: touchpoints
  memory: 2G
  disk_quota: 2G
  timeout: 180
  command: bundle exec rake cf:on_first_instance db:migrate && bundle exec rails s -b 0.0.0.0 -p $PORT -e $RAILS_ENV
  env:
    # Non-secret env vars only - secrets are set via `cf set-env` and should NOT be in this manifest
    # Empty values here would OVERWRITE existing secrets on cf push!
    LOGIN_GOV_CLIENT_ID: urn:gov:gsa:openidconnect.profiles:sp:sso:gsa-tts-opp:touchpoints
    LOGIN_GOV_IDP_BASE_URL: https://secure.login.gov/
    LOGIN_GOV_REDIRECT_URI: https://touchpoints.app.cloud.gov/users/auth/login_dot_gov/callback
    RAILS_ENV: production
    RAILS_SERVE_STATIC_FILES: "true"
    TOUCHPOINTS_WEB_DOMAIN: touchpoints.app.cloud.gov
    INDEX_URL: /admin
    # Secrets managed via cf set-env (DO NOT add empty keys here):
    # - AWS_SES_ACCESS_KEY_ID
    # - AWS_SES_SECRET_ACCESS_KEY
    # - AWS_SES_REGION
    # - LOGIN_GOV_PRIVATE_KEY
    # - NEW_RELIC_KEY
    # - S3_AWS_ACCESS_KEY_ID
    # - S3_AWS_BUCKET_NAME
    # - S3_AWS_REGION
    # - S3_AWS_SECRET_ACCESS_KEY
    # - TOUCHPOINTS_EMAIL_SENDER
    # - TOUCHPOINTS_GTM_CONTAINER_ID
  buildpacks:
    - https://github.com/rileyseaburg/rust-buildpack-touchpoints/archive/refs/tags/v1.0.0.zip
    - nodejs_buildpack
    - ruby_buildpack
  services:
    - touchpoints-prod-db
    - touchpoints-redis-service
    - touchpoints-prod-s3
    - touchpoints-prod-deployer
    - touchpoints-s3-uploads
  routes:
    - route: touchpoints.app.cloud.gov
